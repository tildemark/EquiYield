(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[606],{220:(e,a,t)=>{"use strict";function s(){{let e=window.location.hostname;return"http://".concat(e,":4000")}}t.d(a,{h:()=>s})},2164:(e,a,t)=>{"use strict";t.d(a,{default:()=>r});var s=t(4568),n=t(7620),l=t(220);function i(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function r(e){let{onSuccess:a}=e,[t,r]=(0,n.useState)([]),[c,o]=(0,n.useState)(null),[u,d]=(0,n.useState)(""),[h,m]=(0,n.useState)(""),[p,x]=(0,n.useState)(new Date().toISOString().split("T")[0]),[j,b]=(0,n.useState)("GCASH"),[f,g]=(0,n.useState)(""),[v,N]=(0,n.useState)("");(0,n.useEffect)(()=>{!async function(){let e=(0,l.h)(),[a,t]=await Promise.all([fetch("".concat(e,"/api/admin/users"),{headers:i(),cache:"no-store"}),fetch("".concat(e,"/api/admin/system-config"),{headers:i(),cache:"no-store"})]),[s,n]=await Promise.all([a.json(),t.json()]);r(s),o(n)}()},[]);let S=(0,n.useMemo)(()=>t.find(e=>e.id===u),[t,u]),y=(0,n.useMemo)(()=>S&&c?S.share_count*c.share_value:0,[S,c]),C=Number(h||0),P=C>0&&y>0&&C!==y;async function _(e){if(e.preventDefault(),N(""),!u||!p||!f)return void N("Please fill all required fields.");let t=(0,l.h)(),s=await fetch("".concat(t,"/api/admin/contributions"),{method:"POST",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify({userId:u,amount:C,date_paid:new Date(p).toISOString(),method:j,reference_number:f})}),n=await s.json();s.ok?(N("Saved. Status: ".concat(n.status,". Expected: PHP ").concat(n.expected)),d(""),m(""),x(new Date().toISOString().split("T")[0]),b("GCASH"),g(""),a&&a()):N("Error: ".concat(n.error?JSON.stringify(n.error):"Unknown"))}return(0,s.jsxs)("form",{className:"card space-y-4",onSubmit:_,children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Member"}),(0,s.jsxs)("select",{className:"input",value:u,onChange:e=>d(Number(e.target.value)),children:[(0,s.jsx)("option",{value:"",children:"Select user…"}),t.map(e=>(0,s.jsxs)("option",{value:e.id,children:[e.full_name||e.email," — ",e.email," (shares: ",e.share_count,")"]},e.id))]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Amount (PHP)"}),(0,s.jsx)("input",{className:"input",type:"number",value:h,onChange:e=>m(e.target.value)}),y>0&&(0,s.jsxs)("p",{className:P?"text-yellow-400 text-sm mt-1":"text-gray-400 text-sm mt-1",children:["Expected full amount: PHP ",y]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Date Paid"}),(0,s.jsx)("input",{className:"input",type:"date",value:p,onChange:e=>x(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Method"}),(0,s.jsxs)("select",{className:"input",value:j,onChange:e=>b(e.target.value),children:[(0,s.jsx)("option",{value:"GCASH",children:"GCash"}),(0,s.jsx)("option",{value:"INSTAPAY",children:"InstaPay"}),(0,s.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,s.jsx)("option",{value:"CASH",children:"Cash"})]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Reference Number"}),(0,s.jsx)("input",{className:"input",value:f,onChange:e=>g(e.target.value),placeholder:"e.g., GCash Ref#"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Record Contribution"}),P&&(0,s.jsx)("span",{className:"badge badge-danger",children:"Partial Payment"})]}),v&&(0,s.jsx)("p",{className:"text-sm text-gray-300",children:v})]})}},4281:(e,a,t)=>{Promise.resolve().then(t.bind(t,2164))}},e=>{e.O(0,[587,18,358],()=>e(e.s=4281)),_N_E=e.O()}]);