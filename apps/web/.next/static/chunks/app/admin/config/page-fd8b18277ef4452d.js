(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{220:(e,a,t)=>{"use strict";function n(){{let e=window.location.hostname;return"http://".concat(e,":4000")}}t.d(a,{h:()=>n})},3475:(e,a,t)=>{"use strict";t.d(a,{default:()=>i});var n=t(4568),s=t(7620),r=t(220);function i(){let e=new Date,[a,t]=(0,s.useState)(e.getFullYear()),[i,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[o,m]=(0,s.useState)(!1),[d,h]=(0,s.useState)(""),[g,x]=(0,s.useState)(!1),[p,b]=(0,s.useState)(null),[v,N]=(0,s.useState)(""),j=async()=>{if(window.confirm("Proceed with archive/purge? This cannot be undone.")){x(!0),N(""),b(null);try{let e={year:a,archiveMembers:o,note:d};i&&(e.purgeContributionsBeforeYear=i),c&&(e.purgeLoansBeforeYear=c);let t=(0,r.h)(),n=await fetch("".concat(t,"/api/admin/archive-run"),{method:"POST",headers:{"Content-Type":"application/json",...function(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}()},body:JSON.stringify(e)}),s=await n.json();if(!n.ok)throw Error(s.error||"Archive run failed");b(s)}catch(e){N(e.message)}finally{x(!1)}}};return(0,n.jsxs)("div",{className:"card space-y-3",children:[(0,n.jsx)("h3",{className:"font-semibold",children:"Annual Archive / Purge"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,n.jsxs)("label",{className:"text-sm",children:["Year",(0,n.jsx)("input",{className:"input mt-1",type:"number",value:a,onChange:e=>t(Number(e.target.value))})]}),(0,n.jsxs)("label",{className:"text-sm",children:["Purge Contributions Before Year",(0,n.jsx)("input",{className:"input mt-1",type:"number",value:i,onChange:e=>l(e.target.value?Number(e.target.value):""),placeholder:"optional"})]}),(0,n.jsxs)("label",{className:"text-sm",children:["Purge Loans Before Year",(0,n.jsx)("input",{className:"input mt-1",type:"number",value:c,onChange:e=>u(e.target.value?Number(e.target.value):""),placeholder:"optional"})]}),(0,n.jsxs)("label",{className:"text-sm flex items-center gap-2 mt-6",children:[(0,n.jsx)("input",{type:"checkbox",checked:o,onChange:e=>m(e.target.checked)}),"Archive all current members"]})]}),(0,n.jsx)("textarea",{className:"input min-h-24",placeholder:"Note (optional)",value:d,onChange:e=>h(e.target.value)}),(0,n.jsx)("button",{className:"btn btn-danger",onClick:j,disabled:g,children:g?"Running…":"Run Archive"}),v&&(0,n.jsx)("div",{className:"text-sm text-red-300",children:v}),p&&(0,n.jsxs)("div",{className:"text-sm text-green-300",children:["Done. Purged contributions: ",p.purgedContributions,", purged loans: ",p.purgedLoans,", archived members: ",p.archivedMembers]})]})}},6631:(e,a,t)=>{"use strict";t.d(a,{default:()=>l});var n=t(4568),s=t(7620),r=t(220);function i(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function l(){let[e,a]=(0,s.useState)(null),[t,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[o,m]=(0,s.useState)(""),[d,h]=(0,s.useState)(""),[g,x]=(0,s.useState)(""),[p,b]=(0,s.useState)("");async function v(e){e.preventDefault(),b("Saving...");let n=(0,r.h)(),s=await fetch("".concat(n,"/api/admin/system-config"),{method:"PUT",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify({min_shares:Number(t),max_shares:Number(c),share_value:Number(o),min_loan_amount:Number(d),max_loan_amount:Number(g)})}),l=await s.json();s.ok?(b("✓ Configuration updated successfully"),a(l)):b("Error: ".concat(l.error?JSON.stringify(l.error):"Unknown"))}return((0,s.useEffect)(()=>{!async function(){let e=(0,r.h)(),t=await fetch("".concat(e,"/api/admin/system-config"),{headers:i(),cache:"no-store"}),n=await t.json();a(n),l(String(n.min_shares)),u(String(n.max_shares)),m(String(n.share_value)),h(String(n.min_loan_amount)),x(String(n.max_loan_amount))}()},[]),e)?(0,n.jsxs)("form",{className:"card space-y-4",onSubmit:v,children:[(0,n.jsx)("h3",{className:"font-semibold",children:"System Configuration"}),(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Share Settings"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Min Shares"}),(0,n.jsx)("input",{className:"input",type:"number",min:"1",value:t,onChange:e=>l(e.target.value),required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Max Shares"}),(0,n.jsx)("input",{className:"input",type:"number",min:"1",value:c,onChange:e=>u(e.target.value),required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Share Value (PHP)"}),(0,n.jsx)("input",{className:"input",type:"number",min:"1",value:o,onChange:e=>m(e.target.value),required:!0})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h4",{className:"text-sm font-medium text-gray-400 mb-2",children:"Loan Limits"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Min Loanable Amount (PHP)"}),(0,n.jsx)("input",{className:"input",type:"number",min:"100",value:d,onChange:e=>h(e.target.value),required:!0})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("label",{className:"label",children:"Max Loanable Amount (PHP)"}),(0,n.jsx)("input",{className:"input",type:"number",min:"1000",value:g,onChange:e=>x(e.target.value),required:!0})]})]})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Save Configuration"}),p&&(0,n.jsx)("span",{className:"text-sm text-gray-300",children:p})]})]}):(0,n.jsx)("div",{children:"Loading configuration..."})}},9916:(e,a,t)=>{Promise.resolve().then(t.bind(t,3475)),Promise.resolve().then(t.bind(t,6631))}},e=>{e.O(0,[587,18,358],()=>e(e.s=9916)),_N_E=e.O()}]);