(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[968],{220:(e,t,s)=>{"use strict";function a(){{let e=window.location.hostname;return"http://".concat(e,":4000")}}s.d(t,{h:()=>a})},2164:(e,t,s)=>{"use strict";s.d(t,{default:()=>i});var a=s(4568),l=s(7620),n=s(220);function r(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function i(e){let{onSuccess:t}=e,[s,i]=(0,l.useState)([]),[c,d]=(0,l.useState)(null),[o,x]=(0,l.useState)(""),[m,u]=(0,l.useState)(""),[h,p]=(0,l.useState)(new Date().toISOString().split("T")[0]),[b,g]=(0,l.useState)("GCASH"),[y,j]=(0,l.useState)(""),[N,f]=(0,l.useState)("");(0,l.useEffect)(()=>{!async function(){let e=(0,n.h)(),[t,s]=await Promise.all([fetch("".concat(e,"/api/admin/users"),{headers:r(),cache:"no-store"}),fetch("".concat(e,"/api/admin/system-config"),{headers:r(),cache:"no-store"})]),[a,l]=await Promise.all([t.json(),s.json()]);i(a),d(l)}()},[]);let v=(0,l.useMemo)(()=>s.find(e=>e.id===o),[s,o]),S=(0,l.useMemo)(()=>v&&c?v.share_count*c.share_value:0,[v,c]),C=Number(m||0),P=C>0&&S>0&&C!==S;async function w(e){if(e.preventDefault(),f(""),!o||!h||!y)return void f("Please fill all required fields.");let s=(0,n.h)(),a=await fetch("".concat(s,"/api/admin/contributions"),{method:"POST",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify({userId:o,amount:C,date_paid:new Date(h).toISOString(),method:b,reference_number:y})}),l=await a.json();a.ok?(f("Saved. Status: ".concat(l.status,". Expected: PHP ").concat(l.expected)),x(""),u(""),p(new Date().toISOString().split("T")[0]),g("GCASH"),j(""),t&&t()):f("Error: ".concat(l.error?JSON.stringify(l.error):"Unknown"))}return(0,a.jsxs)("form",{className:"card space-y-4",onSubmit:w,children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Member"}),(0,a.jsxs)("select",{className:"input",value:o,onChange:e=>x(Number(e.target.value)),children:[(0,a.jsx)("option",{value:"",children:"Select user…"}),s.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.full_name||e.email," — ",e.email," (shares: ",e.share_count,")"]},e.id))]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Amount (PHP)"}),(0,a.jsx)("input",{className:"input",type:"number",value:m,onChange:e=>u(e.target.value)}),S>0&&(0,a.jsxs)("p",{className:P?"text-yellow-400 text-sm mt-1":"text-gray-400 text-sm mt-1",children:["Expected full amount: PHP ",S]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Date Paid"}),(0,a.jsx)("input",{className:"input",type:"date",value:h,onChange:e=>p(e.target.value)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Method"}),(0,a.jsxs)("select",{className:"input",value:b,onChange:e=>g(e.target.value),children:[(0,a.jsx)("option",{value:"GCASH",children:"GCash"}),(0,a.jsx)("option",{value:"INSTAPAY",children:"InstaPay"}),(0,a.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,a.jsx)("option",{value:"CASH",children:"Cash"})]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Reference Number"}),(0,a.jsx)("input",{className:"input",value:y,onChange:e=>j(e.target.value),placeholder:"e.g., GCash Ref#"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Record Contribution"}),P&&(0,a.jsx)("span",{className:"badge badge-danger",children:"Partial Payment"})]}),N&&(0,a.jsx)("p",{className:"text-sm text-gray-300",children:N})]})}},3322:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>c});var a=s(4568),l=s(7620),n=s(2164),r=s(220);function i(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function c(){let[e,t]=(0,l.useState)([]),[s,c]=(0,l.useState)(!0),[d,o]=(0,l.useState)(""),[x,m]=(0,l.useState)(0),[u,h]=(0,l.useState)(null),[p,b]=(0,l.useState)(!1),[g,y]=(0,l.useState)(!1),[j,N]=(0,l.useState)(!1),[f,v]=(0,l.useState)(""),[S,C]=(0,l.useState)([]),[P,w]=(0,l.useState)(""),[A,I]=(0,l.useState)(""),T=async()=>{c(!0),o("");try{let e=(0,r.h)(),[s,a]=await Promise.all([fetch("".concat(e,"/api/admin/contributions"),{headers:i(),cache:"no-store"}),fetch("".concat(e,"/api/admin/loans"),{headers:i(),cache:"no-store"})]),l=await s.json(),n=await a.json(),c=[];Array.isArray(l)&&l.forEach(e=>{var t;c.push({id:e.id,type:"CONTRIBUTION",userId:e.userId,userName:(null==(t=e.user)?void 0:t.full_name)||"Unknown",amount:e.amount,date:e.date_paid,reference:e.reference_number,method:e.method,status:e.status})}),(Array.isArray(n)?n:n.data||[]).forEach(e=>{var t;c.push({id:e.id,type:"LOAN_PAYMENT",userId:e.userId||0,userName:(null==(t=e.user)?void 0:t.full_name)||e.borrowerName||"Unknown",amount:e.principal+e.interest,date:e.createdAt,reference:e.id.toString(),loanId:e.id,principal:e.principal,interest:e.interest,loanStatus:e.status})}),c.sort((e,t)=>new Date(t.date).getTime()-new Date(e.date).getTime()),t(c)}catch(e){o(e.message)}finally{c(!1)}},D=async()=>{try{let e=(0,r.h)(),t=await fetch("".concat(e,"/api/admin/loans"),{headers:i(),cache:"no-store"}),s=await t.json(),a=(Array.isArray(s)?s:s.data||[]).filter(e=>"PAID"!==e.status);C(a)}catch(e){console.error("Failed to fetch unpaid loans:",e)}};(0,l.useEffect)(()=>{T(),D()},[x]);let O=async e=>{e.preventDefault(),v(""),N(!0);try{let e=(0,r.h)(),t=await fetch("".concat(e,"/api/admin/loans/").concat(P,"/payment"),{method:"POST",headers:{"Content-Type":"application/json",...i()},body:JSON.stringify({amount:Number(A)})}),s=await t.json();if(!t.ok)throw Error(s.error||"Failed to record loan payment");I(""),w(""),y(!1),m(e=>e+1),await D()}catch(e){v(e.message)}finally{N(!1)}},k=e=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:0}).format(e),R=e=>new Date(e).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"});return(0,a.jsxs)("div",{className:"space-y-6 p-6",children:[(0,a.jsxs)("div",{className:"border-b border-gray-200 pb-4",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2 text-gray-900",children:"Payments Management"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Record contributions, process loan payments, and view comprehensive payment history"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-900",children:"Quick Actions"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4",children:[(0,a.jsxs)("button",{onClick:()=>b(!p),className:"flex items-center gap-3 p-4 bg-blue-50 hover:bg-blue-100 border border-blue-200 rounded-lg transition-colors group",children:[(0,a.jsx)("span",{className:"text-3xl group-hover:scale-110 transition-transform",children:"\uD83D\uDCB0"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:"Record Contribution"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Add a member contribution"})]})]}),(0,a.jsxs)("button",{onClick:()=>y(!g),className:"flex items-center gap-3 p-4 bg-purple-50 hover:bg-purple-100 border border-purple-200 rounded-lg transition-colors group",children:[(0,a.jsx)("span",{className:"text-3xl group-hover:scale-110 transition-transform",children:"\uD83D\uDCE4"}),(0,a.jsxs)("div",{className:"text-left",children:[(0,a.jsx)("div",{className:"font-semibold text-gray-900",children:"Record Loan Payment"}),(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Process a loan payment"})]})]})]})]}),p&&(0,a.jsxs)("div",{className:"card relative",children:[(0,a.jsx)("button",{onClick:()=>b(!1),className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl","aria-label":"Close",children:"\xd7"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-900",children:"Record Member Contribution"}),(0,a.jsx)(n.default,{onSuccess:()=>{m(e=>e+1),b(!1)}})]}),g&&(0,a.jsxs)("div",{className:"card relative",children:[(0,a.jsx)("button",{onClick:()=>{y(!1),I(""),w(""),v("")},className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600 text-2xl","aria-label":"Close",children:"\xd7"}),(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4 text-gray-900",children:"Record Loan Payment"}),(0,a.jsxs)("form",{className:"space-y-4",onSubmit:O,children:[f&&(0,a.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:f}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Select Loan"}),(0,a.jsxs)("select",{className:"input",value:P,onChange:e=>w(e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"-- Choose a loan --"}),S.map(e=>(0,a.jsxs)("option",{value:e.id,children:[e.borrowerName," - ₱",(e.principal+e.interest).toLocaleString()," (",e.status,")"]},e.id))]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label",children:"Amount Paid (PHP)"}),(0,a.jsx)("input",{className:"input",type:"number",min:"0",step:"100",value:A,onChange:e=>I(e.target.value),required:!0})]}),(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{className:"btn btn-primary",type:"submit",disabled:j||!P||!A,children:j?"Recording…":"Record Payment"}),(0,a.jsx)("button",{className:"btn btn-secondary",type:"button",onClick:()=>{y(!1),I(""),w(""),v("")},children:"Cancel"})]})]})]}),u&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,a.jsxs)("div",{className:"card max-w-md w-full mx-4",children:[(0,a.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Payment Details"}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Date"}),(0,a.jsx)("div",{className:"font-semibold",children:R(u.date)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Member"}),(0,a.jsx)("div",{className:"font-semibold",children:u.userName})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Type"}),(0,a.jsx)("div",{className:"font-semibold",children:(0,a.jsx)("span",{className:"inline-block rounded-full px-3 py-1 text-xs font-semibold ".concat("CONTRIBUTION"===u.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"CONTRIBUTION"===u.type?"Contribution":"Loan Payment"})})]}),"CONTRIBUTION"===u.type?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Amount"}),(0,a.jsx)("div",{className:"font-semibold text-lg",children:k(u.amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Method"}),(0,a.jsx)("div",{className:"font-semibold",children:u.method||"N/A"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Status"}),(0,a.jsx)("div",{className:"font-semibold",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat("COMPLETED"===u.status?"bg-green-100 text-green-800":"PARTIAL"===u.status?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"),children:u.status})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Reference"}),(0,a.jsx)("div",{className:"font-mono text-sm",children:u.reference||"N/A"})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Principal"}),(0,a.jsx)("div",{className:"font-semibold",children:k(u.principal||0)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Interest"}),(0,a.jsx)("div",{className:"font-semibold",children:k(u.interest||0)})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Total Amount"}),(0,a.jsx)("div",{className:"font-semibold text-lg",children:k(u.amount)})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-xs text-gray-400",children:"Loan Status"}),(0,a.jsx)("div",{className:"font-semibold",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded text-xs font-semibold ".concat("PENDING"===u.loanStatus?"bg-yellow-100 text-yellow-800":"APPROVED"===u.loanStatus?"bg-green-100 text-green-800":"ACTIVE"===u.loanStatus?"bg-blue-100 text-blue-800":"PAID"===u.loanStatus?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:u.loanStatus})})]})]})]}),(0,a.jsx)("div",{className:"mt-6",children:(0,a.jsx)("button",{className:"btn btn-secondary w-full",onClick:()=>h(null),children:"Close"})})]})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Payment History"}),d&&(0,a.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:d}),s?(0,a.jsx)("div",{children:"Loading payments…"}):0===e.length?(0,a.jsx)("div",{className:"rounded-lg border border-gray-200 bg-gray-50 p-4 text-gray-600",children:"No payments recorded yet"}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full border-collapse",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"border-b border-gray-200 bg-gray-50",children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Date"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Member"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Type"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Amount"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Method/Status"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-semibold text-gray-900",children:"Reference"})]})}),(0,a.jsx)("tbody",{children:e.map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-200 hover:bg-gray-50 cursor-pointer",onClick:()=>h(e),children:[(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-gray-900",children:R(e.date)}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-gray-900",children:e.userName}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm",children:(0,a.jsx)("span",{className:"inline-block rounded-full px-3 py-1 text-xs font-semibold ".concat("CONTRIBUTION"===e.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"CONTRIBUTION"===e.type?"Contribution":"Loan Payment"})}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm font-semibold text-gray-900",children:k(e.amount)}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-gray-600",children:e.method||e.status||"—"}),(0,a.jsx)("td",{className:"px-6 py-3 text-sm text-gray-600 font-mono text-xs",children:e.reference||"—"})]},"".concat(e.type,"-").concat(e.id)))})]})})]})]})}},6600:(e,t,s)=>{Promise.resolve().then(s.bind(s,3322))}},e=>{e.O(0,[587,18,358],()=>e(e.s=6600)),_N_E=e.O()}]);