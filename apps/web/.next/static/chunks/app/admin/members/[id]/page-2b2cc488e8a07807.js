(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[472],{220:(e,t,a)=>{"use strict";function s(){{let e=window.location.hostname;return"http://".concat(e,":4000")}}a.d(t,{h:()=>s})},1379:(e,t,a)=>{Promise.resolve().then(a.bind(a,8931))},7541:(e,t,a)=>{"use strict";var s=a(3041);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}})},8931:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>m});var s=a(4568),n=a(9664),l=a.n(n),r=a(7541),i=a(7620),c=a(220);function d(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function o(e){let{userId:t,onBack:a}=e,[n,l]=(0,i.useState)(null),[r,o]=(0,i.useState)(!0),[m,h]=(0,i.useState)(null),[x,u]=(0,i.useState)(null),[b,j]=(0,i.useState)(new Set),[g,p]=(0,i.useState)(!1),[N,f]=(0,i.useState)(null),[y,v]=(0,i.useState)(!1),[S,A]=(0,i.useState)(""),[w,D]=(0,i.useState)(!1),[C,P]=(0,i.useState)({full_name:"",phone_number:"",email:"",share_count:0,gcashNumber:"",bankName:"",bankAccountNumber:""}),[L,k]=(0,i.useState)([]),[T,E]=(0,i.useState)(!1),[M,R]=(0,i.useState)(""),[I,_]=(0,i.useState)(!1),[O,F]=(0,i.useState)(new Date().toISOString().slice(0,10)),[B,z]=(0,i.useState)(""),[Y,H]=(0,i.useState)("BANK_TRANSFER"),[U,G]=(0,i.useState)(""),[K,J]=(0,i.useState)(!1),[q,V]=(0,i.useState)(""),[$,Q]=(0,i.useState)(!0),[W,X]=(0,i.useState)(!0),[Z,ee]=(0,i.useState)(!0),[et,ea]=(0,i.useState)(!1),[es,en]=(0,i.useState)(new Set),[el,er]=(0,i.useState)(!1),[ei,ec]=(0,i.useState)(null),[ed,eo]=(0,i.useState)(""),[em,eh]=(0,i.useState)(new Date().toISOString().slice(0,10)),[ex,eu]=(0,i.useState)("CASH"),[eb,ej]=(0,i.useState)(""),[eg,ep]=(0,i.useState)(!1),[eN,ef]=(0,i.useState)(""),[ey,ev]=(0,i.useState)(!1),[eS,eA]=(0,i.useState)(null),[ew,eD]=(0,i.useState)(""),[eC,eP]=(0,i.useState)(!1),[eL,ek]=(0,i.useState)(""),[eT,eE]=(0,i.useState)(!1),[eM,eR]=(0,i.useState)(""),[eI,e_]=(0,i.useState)("12"),[eO,eF]=(0,i.useState)(!1),[eB,ez]=(0,i.useState)(""),[eY,eH]=(0,i.useState)([]),[eU,eG]=(0,i.useState)(!1),[eK,eJ]=(0,i.useState)(new Set),eq=e=>{let t=new Set(eK);t.has(e)?t.delete(e):t.add(e),eJ(t)};async function eV(){o(!0),h(null);try{let e=(0,c.h)(),a=await fetch("".concat(e,"/api/admin/users/").concat(t),{headers:d(),cache:"no-store"});if(!a.ok)throw Error("Failed to load user details");let s=await a.json();l(s),P({full_name:s.full_name||"",phone_number:s.phone_number||"",email:s.email||"",share_count:s.share_count||0,gcashNumber:s.gcashNumber||"",bankName:s.bankName||"",bankAccountNumber:s.bankAccountNumber||""}),e$()}catch(e){h(e.message)}finally{o(!1)}}async function e$(){eG(!0);try{let e=(0,c.h)(),a=await fetch("".concat(e,"/api/admin/users/").concat(t,"/pending-loans"),{headers:d(),cache:"no-store"});if(!a.ok)throw Error("Failed to load pending loans");let s=await a.json();eH(s)}catch(e){console.error("Failed to load pending loans:",e.message)}finally{eG(!1)}}async function eQ(){if(!eS)return void ek("No loan selected");if(!ew.trim())return void ek("Please provide a rejection reason");eP(!0),ek("");try{let e=(0,c.h)(),t=await fetch("".concat(e,"/api/admin/loans/").concat(eS,"/reject"),{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({reason:ew})}),a=await t.json();if(!t.ok)throw Error(a.error||"Failed to reject loan");ev(!1),eD(""),eA(null),await e$()}catch(e){ek(e.message)}finally{eP(!1)}}function eW(){v(!1),A(""),n&&P({full_name:n.full_name||"",phone_number:n.phone_number||"",email:n.email||"",share_count:n.share_count||0,gcashNumber:n.gcashNumber||"",bankName:n.bankName||"",bankAccountNumber:n.bankAccountNumber||""})}async function eX(){D(!0),A("");try{let e=(0,c.h)(),a=await fetch("".concat(e,"/api/admin/users/").concat(t),{method:"PUT",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify(C)}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to save changes");v(!1),await eV()}catch(e){A(e.message)}finally{D(!1)}}async function eZ(){if(!B||0>=Number(B))return void V("Amount must be greater than 0");J(!0),V("");try{let e=(0,c.h)(),a=await fetch("".concat(e,"/api/admin/contributions"),{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({userId:t,amount:Number(B),date_paid:new Date(O).toISOString(),method:Y,reference_number:U})}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to record contribution");_(!1),z(""),G(""),H("BANK_TRANSFER"),F(new Date().toISOString().slice(0,10)),await eV()}catch(e){V(e.message)}finally{J(!1)}}async function e0(){if(window.confirm("Reset this member's password?")){p(!0),f(null);try{let e=(0,c.h)(),a=await fetch("".concat(e,"/api/admin/users/").concat(t,"/reset-password"),{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({sendEmail:!1})}),s=await a.json();if(!a.ok)throw Error(s.error||"Reset failed");f(s.password)}catch(e){console.error(e),alert("Failed to reset password")}finally{p(!1)}}}if((0,i.useEffect)(()=>{eV()},[t]),(0,i.useEffect)(()=>{(async()=>{E(!0),R("");try{let e=(0,c.h)(),a=await fetch("".concat(e,"/api/admin/dividends/payouts?userId=").concat(t),{headers:d(),cache:"no-store"}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to load payouts");k(s)}catch(e){R(e.message)}finally{E(!1)}})()},[t]),r)return(0,s.jsx)("div",{children:"Loading member details…"});if(m)return(0,s.jsx)("div",{className:"text-red-400",children:m});if(!n)return(0,s.jsx)("div",{children:"User not found"});let e4=n.paymentDueStatus||[],e1=new Date,e2=e1.getFullYear(),e5=e1.getMonth()+1,e3=e1.getDate(),e7=e4.map(e=>{var t,a,s;let n="".concat(e.year,"-").concat(String(e.month).padStart(2,"0"),"-").concat(String(e.day).padStart(2,"0"));return{...e,dateStr:n,isPast:(t=e.year,a=e.month,s=e.day,!!(t<e2)||t===e2&&!!(a<e5)||t===e2&&a===e5&&!!(s<e3))}}),e6=(e,t,a)=>"".concat(e,"-").concat(String(t).padStart(2,"0"),"-").concat(String(a).padStart(2,"0")),e8=e7.map(e=>({...e,key:e6(e.year,e.month,e.day),paidAllocated:0,contributionsAllocated:[]})).sort((e,t)=>e.year!==t.year?e.year-t.year:e.month!==t.month?e.month-t.month:e.day-t.day);[...n.contributions].sort((e,t)=>new Date(e.date_paid).getTime()-new Date(t.date_paid).getTime()).forEach(e=>{let t,a=e.amount,s=(t=new Date(e.date_paid),e8.findIndex(e=>{let a=new Date(e.year,e.month-1,e.day,23,59,59,999);return t.getTime()<=a.getTime()}));if(-1===s)return;let n=s;for(;a>0&&n<e8.length;){let t=e8[n],l=Math.max(t.expectedAmount-t.paidAllocated,0);if(l<=0){n+=1;continue}let r=Math.min(a,l);t.contributionsAllocated.push({...e,appliedAmount:r,carriedOver:n>s}),t.paidAllocated+=r,(a-=r)>0&&(n+=1)}});let e9=new Map(e8.map(e=>[e.key,e.contributionsAllocated])),te=e7.map(e=>{let t=e6(e.year,e.month,e.day),a=e9.get(t)||[];return{...e,contributions:a,contributionCount:a.length,totalAmount:a.reduce((e,t)=>e+t.appliedAmount,0)}});return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("button",{onClick:a,className:"btn btn-secondary mb-4",children:"← Back to Members"}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold",children:n.full_name}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"btn btn-secondary text-sm",onClick:y?eW:function(){v(!0),A("")},children:y?"Cancel":"Edit"}),(0,s.jsx)("button",{className:"btn btn-secondary text-sm",onClick:e0,disabled:g,children:g?"Resetting…":"Reset Password"})]})]}),S&&(0,s.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:S}),y?(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Full Name"}),(0,s.jsx)("input",{className:"input",value:C.full_name,onChange:e=>P({...C,full_name:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Email"}),(0,s.jsx)("input",{className:"input",type:"email",value:C.email,onChange:e=>P({...C,email:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Phone"}),(0,s.jsx)("input",{className:"input",value:C.phone_number,onChange:e=>P({...C,phone_number:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Shares"}),(0,s.jsx)("input",{className:"input",type:"number",min:"0",value:C.share_count,onChange:e=>P({...C,share_count:Number(e.target.value)})})]})]}),(0,s.jsxs)("div",{className:"border-t pt-4",children:[(0,s.jsx)("h4",{className:"font-semibold text-sm mb-3",children:"Payment Details"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"GCash Number"}),(0,s.jsx)("input",{className:"input",value:C.gcashNumber,onChange:e=>P({...C,gcashNumber:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Bank Name"}),(0,s.jsx)("input",{className:"input",value:C.bankName,onChange:e=>P({...C,bankName:e.target.value})})]}),(0,s.jsxs)("div",{className:"col-span-2",children:[(0,s.jsx)("label",{className:"label",children:"Bank Account Number"}),(0,s.jsx)("input",{className:"input",value:C.bankAccountNumber,onChange:e=>P({...C,bankAccountNumber:e.target.value})})]})]})]}),(0,s.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,s.jsx)("button",{className:"btn btn-primary",onClick:eX,disabled:w,children:w?"Saving…":"Save Changes"}),(0,s.jsx)("button",{className:"btn btn-secondary",onClick:eW,disabled:w,children:"Cancel"})]})]}):(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Email:"})," ",n.email]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Phone:"})," ",n.phone_number]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Shares:"})," ",n.share_count]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Role:"})," ",n.role]}),n.gcashNumber&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"GCash:"})," ",n.gcashNumber]}),n.bankName&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Bank:"})," ",n.bankName]}),n.bankAccountNumber&&(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-gray-400",children:"Bank Account:"})," ",n.bankAccountNumber]})]}),N&&(0,s.jsxs)("div",{className:"mt-2 text-xs",children:["New password: ",(0,s.jsx)("span",{className:"font-mono",children:N})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"Total Contributions"}),(0,s.jsxs)("div",{className:"text-2xl font-bold",children:["₱",n.contributions.reduce((e,t)=>e+t.amount,0).toLocaleString()]})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"Contribution Due Now"}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:(()=>{let e=e7.find(e=>!e.isPast)||e7[e7.length-1];if(!e)return"₱0";let t=Math.max(e.expectedAmount-Math.min(e.totalPaid,e.expectedAmount),0);return"₱".concat(t.toLocaleString())})()})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"Loan Due Now"}),(0,s.jsx)("div",{className:"text-2xl font-bold",children:(()=>{let e=Date.now(),t=0;return(n.loans||[]).forEach(a=>{var s,n,l;let r=new Date(a.releasedAt?a.releasedAt:a.createdAt),i=a.dueDate?new Date(a.dueDate):void 0,c=null!=(s=a.termMonths)?s:0,d=null!=(n=a.monthlyAmortization)?n:0,o=[];if(c>0&&d>0){let e=new Date(r.getFullYear(),r.getMonth(),1);for(let t=0;t<c;t++){let a=new Date(e.getFullYear(),e.getMonth()+t+1,0);if(i&&a>i)break;o.push({date:a,expectedAmount:d})}}else i&&o.push({date:i,expectedAmount:a.principal+a.interest});let m=o.map(()=>0);[...null!=(l=a.payments)?l:[]].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()).forEach(e=>{let t=e.amount,a=o.findIndex(t=>new Date(e.createdAt).getTime()<=t.date.getTime());for(a<0&&(a=0);t>0&&a<o.length;){let e=Math.max(o[a].expectedAmount-m[a],0);if(e<=0){a++;continue}let s=Math.min(t,e);m[a]+=s,(t-=s)>0&&a++}});let h=o.findIndex(t=>t.date.getTime()>=e),x=h>=0?h:o.length-1;if(x>=0){let e=Math.max(o[x].expectedAmount-m[x],0);t+=e}}),"₱".concat(t.toLocaleString())})()})]})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Contribution Payment Schedule"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"btn btn-primary text-sm",onClick:()=>{V(""),_(!0)},children:"+ Add Contribution"}),(0,s.jsx)("button",{className:"btn btn-secondary text-sm",onClick:()=>Q(e=>!e),children:$?"Collapse":"Expand"})]})]}),$?0===te.length?(0,s.jsx)("p",{className:"text-gray-400",children:"No payment schedule available"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"table text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Payment Due Date"}),(0,s.jsx)("th",{children:"Payment Due"}),(0,s.jsx)("th",{children:"Paid So Far"}),(0,s.jsx)("th",{children:"Remaining"}),(0,s.jsx)("th",{children:"Status"}),(0,s.jsx)("th",{children:"Dividend"})]})}),(0,s.jsx)("tbody",{children:te.map(e=>{let t="".concat(e.year,"-").concat(e.month,"-").concat(e.day),a=!e.isPast,n=new Date(e.year,e.month-1).toLocaleString("default",{month:"short"}),l="".concat(n," ").concat(e.day,", ").concat(e.year),r=e.isPast&&("PARTIAL"===e.status||"NO-PAYMENT"===e.status),c=eK.has(t);return(0,s.jsxs)(i.Fragment,{children:[(0,s.jsxs)("tr",{className:"".concat(a?"opacity-50":""," cursor-pointer hover:bg-blue-100/50 transition-colors"),onClick:()=>{eq(t)},children:[(0,s.jsx)("td",{className:"font-medium",children:l}),(0,s.jsxs)("td",{children:["₱",e.expectedAmount.toLocaleString()]}),(0,s.jsxs)("td",{children:[(0,s.jsxs)("span",{className:"font-semibold",children:["₱",e.totalPaid.toLocaleString()]}),e.contributionCount>0&&(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[e.contributionCount," payment",1!==e.contributionCount?"s":""]})]}),(0,s.jsx)("td",{children:(0,s.jsxs)("span",{className:"font-semibold ".concat(e.remainingAmount>0?"text-orange-500":"text-green-500"),children:["₱",e.remainingAmount.toLocaleString()]})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge badge-sm ".concat("PAID"===e.status?"badge-success":"PARTIAL"===e.status?"badge-warning":"badge-danger"),children:e.status})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge badge-sm ".concat(r?"badge-error":"badge-success"),children:r?"LATE PAYMENT":"ELIGIBLE"})})]}),c&&(0,s.jsx)("tr",{className:"bg-gradient-to-br from-blue-50 to-blue-100",children:(0,s.jsx)("td",{colSpan:6,className:"p-0",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("h4",{className:"font-semibold mb-3 text-sm",children:["Contribution Details (",e.contributionCount,")"]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"table table-sm text-xs",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"text-left",children:"Date Paid"}),(0,s.jsx)("th",{className:"text-left",children:"Amount Applied"}),(0,s.jsx)("th",{className:"text-left",children:"Method"}),(0,s.jsx)("th",{className:"text-left",children:"Reference"}),(0,s.jsx)("th",{className:"text-left",children:"Notes"})]})}),(0,s.jsx)("tbody",{children:e.contributions.map((e,t)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700/50",children:[(0,s.jsx)("td",{children:new Date(e.date_paid).toLocaleDateString()}),(0,s.jsxs)("td",{className:"font-semibold",children:["₱",e.appliedAmount.toLocaleString()]}),(0,s.jsx)("td",{children:e.method}),(0,s.jsx)("td",{className:"text-gray-400",children:e.reference_number||"—"}),(0,s.jsx)("td",{className:"text-gray-400",children:e.carriedOver?"Carried over from previous payment":"Applied to this due date"})]},"".concat(e.id,"-").concat(t)))})]})})]})})})]},t)})})]})}):null]}),eY.length>0&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Pending Loan Applications"}),(0,s.jsx)("button",{className:"btn btn-secondary text-sm",onClick:()=>ee(e=>!e),children:Z?"Collapse":"Expand"})]}),Z?eU?(0,s.jsx)("p",{className:"text-gray-400",children:"Loading pending loans..."}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"table table-zebra w-full",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Loan ID"}),(0,s.jsx)("th",{children:"Principal"}),(0,s.jsx)("th",{children:"Interest (%)"}),(0,s.jsx)("th",{children:"Monthly Payment"}),(0,s.jsx)("th",{children:"Term (months)"}),(0,s.jsx)("th",{children:"Requested At"}),(0,s.jsx)("th",{children:"Action"})]})}),(0,s.jsx)("tbody",{children:eY.map(e=>{var t;return(0,s.jsxs)("tr",{children:[(0,s.jsxs)("td",{children:["#",e.id]}),(0,s.jsxs)("td",{children:["₱",e.principal.toLocaleString()]}),(0,s.jsxs)("td",{children:[e.interest,"%"]}),(0,s.jsxs)("td",{children:["₱",(null==(t=e.monthlyAmortization)?void 0:t.toLocaleString())||"—"]}),(0,s.jsx)("td",{children:e.termMonths||"—"}),(0,s.jsx)("td",{children:new Date(e.createdAt).toLocaleDateString()}),(0,s.jsx)("td",{children:(0,s.jsx)("button",{className:"btn btn-error btn-sm",onClick:()=>{eA(e.id),eD(""),ek(""),ev(!0)},children:"Reject"})})]},e.id)})})]})}):null]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"Loans"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"btn btn-success text-sm",onClick:()=>{ez(""),eR(""),e_("12"),eE(!0)},children:"+ Create Loan"}),(0,s.jsx)("button",{className:"btn btn-primary text-sm",onClick:()=>{var e,t;ef("");let a=null!=(t=null==n||null==(e=n.loans[0])?void 0:e.id)?t:null;ec(a),eo(""),eh(new Date().toISOString().slice(0,10)),eu("CASH"),ej(""),a&&er(!0)},children:"+ Record Loan Payment"}),(0,s.jsx)("button",{className:"btn btn-secondary text-sm",onClick:()=>X(e=>!e),children:W?"Collapse":"Expand"})]})]}),W?n&&0!==n.loans.length?(0,s.jsx)("div",{className:"space-y-6",children:n.loans.map(e=>{var t,a,n;let l=e.name?"Loan: ".concat(e.name):"Loan #".concat(e.id),r=new Date(e.releasedAt?e.releasedAt:e.createdAt),c=e.dueDate?new Date(e.dueDate):void 0,d=null!=(t=e.termMonths)?t:0,o=null!=(a=e.monthlyAmortization)?a:0,m=[];if(d>0&&o>0){let e=new Date(r.getFullYear(),r.getMonth(),1);for(let t=0;t<d;t++){let a=new Date(e.getFullYear(),e.getMonth()+t+1,0);if(c&&a>c)break;m.push({year:a.getFullYear(),month:a.getMonth()+1,day:a.getDate(),date:a,expectedAmount:o})}}else c&&e.principal+e.interest>0&&m.push({year:c.getFullYear(),month:c.getMonth()+1,day:c.getDate(),date:c,expectedAmount:e.principal+e.interest});let h=m.map(()=>[]),x=m.map(()=>0);[...null!=(n=e.payments)?n:[]].sort((e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime()).forEach(e=>{let t=e.amount,a=m.findIndex(t=>!e.createdAt||new Date(e.createdAt).getTime()<=t.date.getTime());for(a<0&&(a=0);t>0&&a<m.length;){let s=Math.max(m[a].expectedAmount-x[a],0);if(s<=0){a++;continue}let n=Math.min(t,s);h[a].push({amount:e.amount,createdAt:e.createdAt,appliedAmount:n,carriedOver:h[a].length>0}),x[a]+=n,(t-=n)>0&&a++}});let u=m.map((e,t)=>{let a=x[t],s=Math.max(e.expectedAmount-a,0),n="NO-PAYMENT";n=a>=e.expectedAmount?"PAID":a>0?"PARTIAL":"NO-PAYMENT";let l=new Date>e.date;return{key:"".concat(e.year,"-").concat(e.month,"-").concat(e.day),s:e,totalPaid:a,remainingAmount:s,status:n,isPast:l,isLate:l&&0===a,payments:h[t]}}),b=es.has(e.id);return(0,s.jsxs)("div",{className:"border rounded p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold",children:l}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["Principal ₱",e.principal.toLocaleString()," • Interest ₱",e.interest.toLocaleString()," • Status ",e.status]})]}),(0,s.jsx)("button",{className:"btn btn-ghost btn-xs",onClick:()=>{var t;return t=e.id,void en(e=>{let a=new Set(e);return a.has(t)?a.delete(t):a.add(t),a})},children:b?"Expand":"Collapse"})]}),b?null:0===u.length?(0,s.jsx)("p",{className:"text-gray-400 mt-3",children:"No amortization schedule available"}):(0,s.jsx)("div",{className:"mt-4 overflow-x-auto",children:(0,s.jsxs)("table",{className:"table text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Due Date"}),(0,s.jsx)("th",{children:"Amortization"}),(0,s.jsx)("th",{children:"Paid So Far"}),(0,s.jsx)("th",{children:"Remaining"}),(0,s.jsx)("th",{children:"Status"}),(0,s.jsx)("th",{children:"Late"})]})}),(0,s.jsx)("tbody",{children:u.map(e=>(0,s.jsxs)(i.Fragment,{children:[(0,s.jsxs)("tr",{className:"".concat(e.isPast?"":"opacity-50"," cursor-pointer hover:bg-green-100/50 transition-colors"),onClick:()=>e.payments.length>0&&eq(e.key),children:[(0,s.jsx)("td",{className:"font-medium",children:new Date(e.s.date).toLocaleDateString()}),(0,s.jsxs)("td",{children:["₱",e.s.expectedAmount.toLocaleString()]}),(0,s.jsxs)("td",{children:[(0,s.jsxs)("span",{className:"font-semibold",children:["₱",e.totalPaid.toLocaleString()]}),e.payments.length>0&&(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:[eK.has(e.key)?"▼":"▶"," ",e.payments.length," payment",1!==e.payments.length?"s":""]})]}),(0,s.jsx)("td",{children:(0,s.jsxs)("span",{className:"font-semibold ".concat(e.remainingAmount>0?"text-orange-500":"text-green-500"),children:["₱",e.remainingAmount.toLocaleString()]})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge badge-sm ".concat("PAID"===e.status?"badge-success":"PARTIAL"===e.status?"badge-warning":"badge-danger"),children:e.status})}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge badge-sm ".concat(e.isLate?"badge-error":"badge-neutral"),children:e.isLate?"LATE":"—"})})]}),e.payments.length>0&&eK.has(e.key)&&(0,s.jsx)("tr",{className:"bg-gradient-to-br from-green-50 to-green-100",children:(0,s.jsx)("td",{colSpan:6,className:"p-0",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("h5",{className:"font-semibold mb-3 text-sm",children:["Payments Applied (",e.payments.length,")"]}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"table table-sm text-xs",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,s.jsx)("th",{className:"text-left",children:"Date Paid"}),(0,s.jsx)("th",{className:"text-left",children:"Amount Applied"}),(0,s.jsx)("th",{className:"text-left",children:"Method"}),(0,s.jsx)("th",{className:"text-left",children:"Reference"}),(0,s.jsx)("th",{className:"text-left",children:"Notes"})]})}),(0,s.jsx)("tbody",{children:e.payments.map((t,a)=>(0,s.jsxs)("tr",{className:"border-b border-gray-700/50",children:[(0,s.jsx)("td",{children:new Date(t.date_paid||t.createdAt).toLocaleDateString()}),(0,s.jsxs)("td",{className:"font-semibold",children:["₱",t.appliedAmount.toLocaleString()]}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge badge-xs",children:"BANK_TRANSFER"===t.payment_method?"BANK":t.payment_method||"CASH"})}),(0,s.jsx)("td",{className:"text-gray-400 text-xs",children:t.reference||"—"}),(0,s.jsx)("td",{className:"text-gray-400",children:t.carriedOver?"Carried over from previous payment":"Applied to this amortization"})]},"".concat(e.key,"-").concat(a)))})]})})]})})})]},e.key))})]})})]},e.id)})}):(0,s.jsx)("p",{className:"text-gray-400",children:"No loans recorded"}):null]}),n.coMakerOnLoans&&n.coMakerOnLoans.length>0&&(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Co-Maker on Loans"}),(0,s.jsxs)("div",{className:"rounded-lg border border-orange-200 bg-orange-50 p-3 mb-4",children:[(0,s.jsx)("p",{className:"text-sm text-orange-800 font-semibold",children:"⚠️ Co-Maker Responsibility"}),(0,s.jsx)("p",{className:"text-xs text-orange-700 mt-1",children:"As a co-maker, this member is responsible for loan payments if the borrower defaults. Monitor payment status regularly."})]}),(0,s.jsx)("div",{className:"space-y-6",children:n.coMakerOnLoans.map(e=>{var t;let a=e.loan,n=a.user,l="Loan #".concat(a.id," - ").concat((null==n?void 0:n.full_name)||a.borrowerName),r=(null==(t=a.payments)?void 0:t.reduce((e,t)=>e+t.amount,0))||0,i=a.principal+a.interest-r,c=i<=0,d=a.monthlyAmortization||0,o=a.termMonths||0,m=a.releasedAt?new Date(a.releasedAt):null,h=0,x=0,u=!1;if(m&&o>0&&d>0){let e=r;for(let t=0;t<o;t++){let a=new Date(m.getFullYear(),m.getMonth()+t+1,m.getDate())<new Date;e>=d?e-=d:a&&(h+=d-e,x++,e=0)}u=x>=2}let b=[];if(m&&o>0){let e=0;for(let t=0;t<o;t++){let a=new Date(m.getFullYear(),m.getMonth()+t+1,m.getDate()),s=e,n=Math.max(0,d-s),l=n>0&&new Date>a,r="UNPAID";s>=d?(r="PAID",e=s-d):(s>0&&(r="PARTIAL"),e=0),b.push({monthNumber:t+1,dueDate:a,amortization:d,paidSoFar:s,remaining:n,status:r,isLate:l})}let t=0,s=0;for(let e of b){let n=s;for(;n<e.amortization&&t<a.payments.length;)n+=a.payments[t].amount,t++;e.paidSoFar=Math.min(n,e.amortization),e.remaining=Math.max(0,e.amortization-e.paidSoFar),s=Math.max(0,n-e.amortization),e.paidSoFar>=e.amortization?e.status="PAID":e.paidSoFar>0?e.status="PARTIAL":e.status="UNPAID",e.isLate=e.remaining>0&&new Date>e.dueDate}}return(0,s.jsxs)("div",{className:"border rounded-lg p-4 ".concat(u?"border-red-500 bg-red-50":h>0?"border-yellow-500 bg-yellow-50":"border-gray-700"),children:[u&&(0,s.jsxs)("div",{className:"mb-3 rounded-lg border border-red-300 bg-red-100 p-2",children:[(0,s.jsx)("p",{className:"text-sm text-red-800 font-bold",children:"\uD83D\uDEA8 LOAN DEFAULTED"}),(0,s.jsxs)("p",{className:"text-xs text-red-700 mt-1",children:["Borrower is ",x," months behind. Co-maker may be contacted to settle this loan."]})]}),!u&&h>0&&(0,s.jsxs)("div",{className:"mb-3 rounded-lg border border-yellow-300 bg-yellow-100 p-2",children:[(0,s.jsx)("p",{className:"text-sm text-yellow-800 font-semibold",children:"⚠️ Payment Overdue"}),(0,s.jsxs)("p",{className:"text-xs text-yellow-700 mt-1",children:[x," month(s) overdue. Total overdue: ₱",h.toLocaleString(),". Borrower should be followed up."]})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h4",{className:"font-semibold text-lg",children:l}),(0,s.jsxs)("p",{className:"text-sm text-gray-400",children:["Borrower: ",(null==n?void 0:n.email)||a.borrowerEmail]})]}),(0,s.jsx)("div",{className:"text-right",children:(0,s.jsx)("div",{className:"badge ".concat(c?"badge-success":u?"badge-error":h>0?"badge-warning":"badge-primary"),children:u?"DEFAULTED":a.status})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Monthly Payment"}),(0,s.jsxs)("p",{className:"font-semibold",children:["₱",d.toLocaleString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Total Paid"}),(0,s.jsxs)("p",{className:"font-semibold text-success",children:["₱",r.toLocaleString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Remaining Balance"}),(0,s.jsxs)("p",{className:"font-semibold text-warning",children:["₱",i.toLocaleString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-xs text-gray-400",children:"Overdue Amount"}),(0,s.jsx)("p",{className:"font-semibold ".concat(h>0?"text-error":"text-success"),children:h>0?"₱".concat(h.toLocaleString()):"₱0"})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-2 mb-4 text-xs",children:[(0,s.jsxs)("div",{className:"bg-base-200 rounded p-2 text-center",children:[(0,s.jsx)("div",{className:"text-gray-400",children:"Payment Status"}),(0,s.jsx)("div",{className:"font-semibold mt-1 ".concat(u?"text-error":h>0?"text-warning":"text-success"),children:u?"DEFAULTED":h>0?"OVERDUE":"UP TO DATE"})]}),(0,s.jsxs)("div",{className:"bg-base-200 rounded p-2 text-center",children:[(0,s.jsx)("div",{className:"text-gray-400",children:"Overdue Months"}),(0,s.jsx)("div",{className:"font-semibold mt-1 ".concat(x>0?"text-error":"text-success"),children:x})]}),(0,s.jsxs)("div",{className:"bg-base-200 rounded p-2 text-center",children:[(0,s.jsx)("div",{className:"text-gray-400",children:"Term Progress"}),(0,s.jsx)("div",{className:"font-semibold mt-1",children:o>0?"".concat(Math.min(Math.floor(r/d),o),"/").concat(o):"—"})]})]}),b.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("h5",{className:"font-semibold mb-2",children:"Monthly Amortization Schedule"}),(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"table table-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Month"}),(0,s.jsx)("th",{children:"Due Date"}),(0,s.jsx)("th",{children:"Amortization"}),(0,s.jsx)("th",{children:"Paid So Far"}),(0,s.jsx)("th",{children:"Remaining"}),(0,s.jsx)("th",{children:"Status"})]})}),(0,s.jsx)("tbody",{children:b.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.monthNumber}),(0,s.jsxs)("td",{children:[e.dueDate.toLocaleDateString(),e.isLate&&(0,s.jsx)("span",{className:"ml-2 badge badge-error badge-xs",children:"LATE"})]}),(0,s.jsxs)("td",{children:["₱",e.amortization.toLocaleString()]}),(0,s.jsxs)("td",{children:["₱",e.paidSoFar.toLocaleString()]}),(0,s.jsxs)("td",{className:e.remaining>0?"text-warning":"",children:["₱",e.remaining.toLocaleString()]}),(0,s.jsx)("td",{children:(0,s.jsx)("span",{className:"badge badge-xs ".concat("PAID"===e.status?"badge-success":"PARTIAL"===e.status?"badge-warning":"badge-ghost"),children:e.status})})]},e.monthNumber))})]})})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Dividend Payouts Issued"}),T?(0,s.jsx)("div",{className:"text-sm text-gray-400",children:"Loading payouts…"}):0===L.length?(0,s.jsx)("p",{className:"text-gray-400",children:"No payout records"}):(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Year"}),(0,s.jsx)("th",{children:"Amount"}),(0,s.jsx)("th",{children:"Disbursement Method"}),(0,s.jsx)("th",{children:"No. of Shares"}),(0,s.jsx)("th",{children:"Payout Per Share"}),(0,s.jsx)("th",{children:"Deposited Date"}),(0,s.jsx)("th",{children:"Reference"})]})}),(0,s.jsx)("tbody",{children:L.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{className:"font-semibold",children:e.year}),(0,s.jsxs)("td",{className:"font-semibold",children:["₱",e.amount.toLocaleString()]}),(0,s.jsxs)("td",{children:[(0,s.jsx)("span",{className:"badge badge-sm",children:e.channel}),(0,s.jsx)("div",{className:"text-xs text-gray-400 mt-1",children:"BANK"===e.channel?"".concat(e.bankName||""," ").concat(e.bankAccountNumber||""):e.gcashNumber||""})]}),(0,s.jsx)("td",{children:e.sharesCount}),(0,s.jsxs)("td",{children:["₱",e.perShare.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})]}),(0,s.jsx)("td",{children:new Date(e.depositedAt).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"})}),(0,s.jsx)("td",{className:"text-xs text-gray-400",children:e.reference||"—"})]},e.id))})]})})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold",children:"All Transactions"}),(0,s.jsx)("button",{className:"btn btn-secondary text-sm",onClick:()=>ea(e=>!e),children:et?"Collapse":"Expand"})]}),et&&(0,s.jsx)("div",{className:"overflow-x-auto",children:(()=>{var e;let t=[];n.contributions.forEach(e=>{t.push({date:new Date(e.date_paid),dateStr:e.date_paid,type:"CONTRIBUTION",description:"Contribution Payment",debit:0,credit:e.amount,balance:0,reference:e.reference_number,method:e.method})}),n.loans.forEach(e=>{let a=new Date(e.releasedAt?e.releasedAt:e.createdAt);t.push({date:a,dateStr:e.releasedAt||e.createdAt,type:"LOAN_DISBURSEMENT",description:"Loan #".concat(e.id," Disbursement"),debit:e.principal,credit:0,balance:0,reference:"LOAN-".concat(e.id)}),(e.payments||[]).forEach(a=>{t.push({date:new Date(a.createdAt),dateStr:a.createdAt,type:"LOAN_PAYMENT",description:"Loan #".concat(e.id," Payment"),debit:0,credit:a.amount,balance:0,reference:"LOAN-".concat(e.id)})})}),t.sort((e,t)=>e.date.getTime()-t.date.getTime());let a=0;return(t.forEach(e=>{"CONTRIBUTION"===e.type||"LOAN_PAYMENT"===e.type?a+=e.credit:"LOAN_DISBURSEMENT"===e.type&&(a-=e.debit),e.balance=a}),0===t.length)?(0,s.jsx)("p",{className:"text-gray-400",children:"No transactions found"}):(0,s.jsxs)("table",{className:"table text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Date"}),(0,s.jsx)("th",{children:"Description"}),(0,s.jsx)("th",{children:"Method/Ref"}),(0,s.jsx)("th",{className:"text-right",children:"Debit"}),(0,s.jsx)("th",{className:"text-right",children:"Credit"}),(0,s.jsx)("th",{className:"text-right",children:"Balance"})]})}),(0,s.jsx)("tbody",{children:t.map((e,t)=>(0,s.jsxs)("tr",{className:"hover:bg-gray-700/50",children:[(0,s.jsx)("td",{className:"text-xs",children:new Date(e.dateStr).toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"})}),(0,s.jsxs)("td",{children:[(0,s.jsx)("span",{className:"badge badge-sm mr-2 ".concat("CONTRIBUTION"===e.type?"badge-success":"LOAN_PAYMENT"===e.type?"badge-info":"badge-warning"),children:"CONTRIBUTION"===e.type?"CONTRIB":"LOAN_PAYMENT"===e.type?"PAYMENT":"DISBURSEMENT"}),e.description]}),(0,s.jsxs)("td",{className:"text-xs text-gray-400",children:[e.method&&(0,s.jsx)("div",{children:e.method}),e.reference&&(0,s.jsx)("div",{children:e.reference})]}),(0,s.jsx)("td",{className:"text-right font-mono",children:e.debit>0?(0,s.jsxs)("span",{className:"text-red-400",children:["₱",e.debit.toLocaleString()]}):(0,s.jsx)("span",{className:"text-gray-600",children:"—"})}),(0,s.jsx)("td",{className:"text-right font-mono",children:e.credit>0?(0,s.jsxs)("span",{className:"text-green-400",children:["₱",e.credit.toLocaleString()]}):(0,s.jsx)("span",{className:"text-gray-600",children:"—"})}),(0,s.jsxs)("td",{className:"text-right font-mono font-semibold",children:["₱",e.balance.toLocaleString()]})]},t))}),(0,s.jsx)("tfoot",{children:(0,s.jsxs)("tr",{className:"font-bold border-t-2",children:[(0,s.jsx)("td",{colSpan:3,className:"text-right",children:"Final Balance:"}),(0,s.jsxs)("td",{className:"text-right font-mono text-red-400",children:["₱",t.reduce((e,t)=>e+t.debit,0).toLocaleString()]}),(0,s.jsxs)("td",{className:"text-right font-mono text-green-400",children:["₱",t.reduce((e,t)=>e+t.credit,0).toLocaleString()]}),(0,s.jsxs)("td",{className:"text-right font-mono",children:["₱",((null==(e=t[t.length-1])?void 0:e.balance)||0).toLocaleString()]})]})})]})})()})]}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Cycle Eligibility History"}),0===n.cycleDividendStatus.length?(0,s.jsx)("p",{className:"text-gray-400",children:"No eligibility records"}):(0,s.jsx)("div",{className:"grid grid-cols-4 gap-2",children:n.cycleDividendStatus.map(e=>(0,s.jsxs)("div",{className:"p-3 rounded border ".concat(e.isEligible?"border-green-500/30 bg-green-500/10":"border-red-500/30 bg-red-500/10"),children:[(0,s.jsxs)("div",{className:"text-sm font-semibold",children:[e.year," C",e.cycle]}),(0,s.jsx)("div",{className:"text-xs text-gray-400",children:e.isEligible?"Eligible":"Ineligible"}),!e.isEligible&&e.reason?(0,s.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.reason}):null]},"".concat(e.year,"-").concat(e.cycle)))})]}),el&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,s.jsxs)("div",{className:"card max-w-md w-full mx-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Record Loan Payment"}),eN&&(0,s.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:eN}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Loan"}),(0,s.jsx)("select",{className:"input w-full",value:null!=ei?ei:"",onChange:e=>ec(Number(e.target.value)||null),children:n.loans.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name?e.name:"Loan #".concat(e.id)},e.id))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Amount (PHP) *"}),(0,s.jsx)("input",{type:"number",className:"input w-full",value:ed,onChange:e=>eo(e.target.value),placeholder:"0",step:"100",min:"0"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Date Paid *"}),(0,s.jsx)("input",{type:"date",className:"input w-full",value:em,onChange:e=>eh(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Payment Method *"}),(0,s.jsxs)("select",{className:"input w-full",value:ex,onChange:e=>eu(e.target.value),children:[(0,s.jsx)("option",{value:"CASH",children:"Cash"}),(0,s.jsx)("option",{value:"GCASH",children:"GCash"}),(0,s.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,s.jsx)("option",{value:"INSTAPAY",children:"Instapay"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Reference Number"}),(0,s.jsx)("input",{type:"text",className:"input w-full",value:eb,onChange:e=>ej(e.target.value),placeholder:"Optional reference/transaction ID"})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,s.jsx)("button",{className:"btn btn-primary flex-1",onClick:async()=>{if(!ei)return void ef("Please select a loan");let e=parseInt(ed||"0",10)||0;if(e<=0)return void ef("Enter a valid amount");ep(!0),ef("");try{let t=(0,c.h)(),a=await fetch("".concat(t,"/api/admin/loans/").concat(ei,"/payment"),{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({amount:e,date_paid:new Date(em).toISOString(),payment_method:ex,reference:eb})}),s=await a.json();if(!a.ok)throw Error(s.error||"Failed to record loan payment");er(!1),eo(""),eh(new Date().toISOString().slice(0,10)),eu("CASH"),ej(""),await eV()}catch(e){ef(e.message)}finally{ep(!1)}},disabled:eg,children:eg?"Recording…":"Record Payment"}),(0,s.jsx)("button",{className:"btn btn-secondary flex-1",onClick:()=>{er(!1),eo(""),eh(new Date().toISOString().slice(0,10)),eu("CASH"),ej(""),ef("")},disabled:eg,children:"Cancel"})]})]})}),ey&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,s.jsxs)("div",{className:"card max-w-md w-full mx-4",children:[(0,s.jsx)("h2",{className:"text-xl font-bold mb-4",children:"Reject Pending Loan Application"}),eL&&(0,s.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:eL}),(0,s.jsx)("div",{className:"space-y-4",children:(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Rejection Reason *"}),(0,s.jsx)("textarea",{className:"textarea textarea-bordered w-full",placeholder:"Provide a reason for rejecting this loan application...",value:ew,onChange:e=>eD(e.target.value),rows:4})]})}),(0,s.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,s.jsx)("button",{className:"btn btn-error flex-1",onClick:eQ,disabled:eC,children:eC?"Rejecting…":"Reject Loan"}),(0,s.jsx)("button",{className:"btn btn-secondary flex-1",onClick:()=>{ev(!1),eD(""),ek(""),eA(null)},disabled:eC,children:"Cancel"})]})]})}),I&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,s.jsxs)("div",{className:"card max-w-md w-full mx-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-4",children:["Record Contribution for ",null==n?void 0:n.full_name]}),q&&(0,s.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:q}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Date Paid *"}),(0,s.jsx)("input",{type:"date",className:"input w-full",value:O,onChange:e=>F(e.target.value)})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Amount (PHP) *"}),(0,s.jsx)("input",{type:"number",className:"input w-full",value:B,onChange:e=>z(e.target.value),placeholder:"0",step:"100",min:"0"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Payment Method *"}),(0,s.jsxs)("select",{className:"input w-full",value:Y,onChange:e=>H(e.target.value),children:[(0,s.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,s.jsx)("option",{value:"GCASH",children:"GCash"}),(0,s.jsx)("option",{value:"INSTAPAY",children:"Instapay"}),(0,s.jsx)("option",{value:"CASH",children:"Cash"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Reference Number"}),(0,s.jsx)("input",{type:"text",className:"input w-full",value:U,onChange:e=>G(e.target.value),placeholder:"Transaction ID, receipt number, etc"})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,s.jsx)("button",{className:"btn btn-primary flex-1",onClick:eZ,disabled:K,children:K?"Recording…":"Record Contribution"}),(0,s.jsx)("button",{className:"btn btn-secondary flex-1",onClick:()=>{_(!1),V(""),z(""),G("")},disabled:K,children:"Cancel"})]})]})}),eT&&(0,s.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,s.jsxs)("div",{className:"card max-w-md w-full mx-4",children:[(0,s.jsxs)("h2",{className:"text-xl font-bold mb-4",children:["Create Loan for ",null==n?void 0:n.full_name]}),eB&&(0,s.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-700",children:eB}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Principal Amount (PHP) *"}),(0,s.jsx)("input",{type:"number",className:"input w-full",value:eM,onChange:e=>eR(e.target.value),placeholder:"0",step:"100",min:"0"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Term (Months) *"}),(0,s.jsx)("input",{type:"number",className:"input w-full",value:eI,onChange:e=>e_(e.target.value),placeholder:"12",step:"1",min:"1"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"label",children:"Interest Rate"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("input",{type:"number",className:"input flex-1",value:"5",disabled:!0,step:"0.5",min:"0"}),(0,s.jsx)("span",{className:"text-sm text-gray-400",children:"% (Fixed)"})]})]}),(0,s.jsxs)("div",{className:"bg-gray-800 p-4 rounded text-sm space-y-3 border border-gray-700",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Principal"}),(0,s.jsxs)("div",{className:"font-mono text-base font-semibold",children:["₱",(parseFloat(eM||"0")||0).toLocaleString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Interest Rate"}),(0,s.jsx)("div",{className:"font-mono text-base font-semibold",children:"5%"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Calculated Interest"}),(0,s.jsxs)("div",{className:"font-mono text-base font-semibold",children:["₱",Math.round(.05*(parseFloat(eM||"0")||0)).toLocaleString()]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Total Due"}),(0,s.jsxs)("div",{className:"font-mono text-base font-semibold text-green-400",children:["₱",(()=>{let e=parseFloat(eM||"0")||0,t=Math.round(.05*e);return(e+t).toLocaleString()})()]})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-700 pt-3",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400 mb-2",children:"Monthly Amortization"}),(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"font-mono text-lg font-bold text-blue-400",children:["₱",(()=>{let e=parseFloat(eM||"0")||0,t=Math.round(.05*e);return Math.round((e+t)/(parseInt(eI||"12")||12)).toLocaleString()})()]}),(0,s.jsxs)("div",{className:"text-xs text-gray-400",children:["per month for ",eI," months"]})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-700 pt-3",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400",children:"Payment Schedule"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2 mt-2",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Term"}),(0,s.jsxs)("div",{className:"font-mono",children:[eI," months"]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-xs text-gray-500",children:"Est. Completion"}),(0,s.jsx)("div",{className:"font-mono text-xs",children:(()=>{let e=parseInt(eI||"12")||12,t=new Date;return t.setMonth(t.getMonth()+e),t.toLocaleDateString("en-PH",{year:"numeric",month:"short",day:"numeric"})})()})]})]})]})]})]}),(0,s.jsxs)("div",{className:"mt-6 flex gap-2",children:[(0,s.jsx)("button",{className:"btn btn-primary flex-1",onClick:async()=>{if(!eM||0>=parseFloat(eM))return void ez("Principal must be greater than 0");if(!eI||0>=parseInt(eI))return void ez("Term must be greater than 0");if(!(null==n?void 0:n.email)||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n.email))return void ez('Member email "'.concat((null==n?void 0:n.email)||"unknown","\" is invalid. Please fix the member's email first."));eF(!0),ez("");try{let e=parseFloat(eM),a=parseInt(eI),s=Math.round(.05*e),l=Math.round((e+s)/a),r=(0,c.h)(),i=await fetch("".concat(r,"/api/admin/loans"),{method:"POST",headers:{"Content-Type":"application/json",...d()},body:JSON.stringify({userId:t,borrowerType:"MEMBER",borrowerName:(null==n?void 0:n.full_name)||"",borrowerEmail:(null==n?void 0:n.email)||"",borrowerPhone:(null==n?void 0:n.phone_number)||"",principal:e,interest:s,termMonths:a,interestRate:5,monthlyAmortization:l})}),o=await i.json();if(!i.ok)throw Error(o.error||"Failed to create loan");eE(!1),eR(""),e_("12"),await eV()}catch(e){ez(e.message)}finally{eF(!1)}},disabled:eO,children:eO?"Creating…":"Create Loan"}),(0,s.jsx)("button",{className:"btn btn-secondary flex-1",onClick:()=>{eE(!1),ez(""),eR(""),e_("12")},disabled:eO,children:"Cancel"})]})]})})]})}function m(){let e=(0,r.useParams)(),t=(0,r.useRouter)(),a=Number(e.id);return(0,s.jsxs)("main",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold",children:"Member Details"}),(0,s.jsx)(l(),{href:"/admin/members",className:"btn btn-secondary text-sm",children:"Back to Members"})]}),(0,s.jsx)(o,{userId:a,onBack:()=>t.back()})]})}}},e=>{e.O(0,[664,587,18,358],()=>e(e.s=1379)),_N_E=e.O()}]);