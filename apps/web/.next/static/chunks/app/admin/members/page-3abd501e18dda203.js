(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[538],{220:(e,s,a)=>{"use strict";function t(){{let e=window.location.hostname;return"http://".concat(e,":4000")}}a.d(s,{h:()=>t})},537:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>u});var t=a(4568),n=a(7620),l=a(7541),r=a(220);function c(e){let{refreshToken:s,onIdsChange:a}=e,[c,i]=(0,n.useState)([]),[o,d]=(0,n.useState)(1),[m,u]=(0,n.useState)(20),[h,x]=(0,n.useState)(1),[b,j]=(0,n.useState)(!0),[p,g]=(0,n.useState)(null),N=(0,l.useRouter)();async function f(){j(!0),g(null);try{let e=(0,r.h)(),s=await fetch("".concat(e,"/api/admin/users?page=").concat(o,"&pageSize=").concat(m),{headers:function(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}(),cache:"no-store"});if(!s.ok)throw Error("Failed to load users");let t=await s.json();t&&t.data?(i(t.data),x(t.totalPages),a&&a(t.data.map(e=>e.id))):(i(t),x(1),a&&a(t.map(e=>e.id)))}catch(e){g(e.message)}finally{j(!1)}}return((0,n.useEffect)(()=>{f()},[s,o,m]),b)?(0,t.jsx)("div",{children:"Loading members…"}):p?(0,t.jsx)("div",{className:"text-red-400",children:p}):(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,t.jsxs)("div",{className:"text-sm text-gray-400",children:["Page ",o," of ",h]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-xs text-gray-400",children:"Page size"}),(0,t.jsx)("select",{className:"input text-sm",value:m,onChange:e=>u(Number(e.target.value)),children:[10,20,50,100].map(e=>(0,t.jsx)("option",{value:e,children:e},e))}),(0,t.jsxs)("div",{className:"space-x-2",children:[(0,t.jsx)("button",{className:"btn btn-secondary",disabled:o<=1,onClick:()=>d(e=>Math.max(1,e-1)),children:"Prev"}),(0,t.jsx)("button",{className:"btn btn-secondary",disabled:o>=h,onClick:()=>d(e=>Math.min(h,e+1)),children:"Next"})]})]})]}),(0,t.jsxs)("table",{className:"table",children:[(0,t.jsx)("thead",{children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{children:"ID"}),(0,t.jsx)("th",{children:"Name"}),(0,t.jsx)("th",{children:"Email"}),(0,t.jsx)("th",{children:"Phone"}),(0,t.jsx)("th",{children:"Shares"}),(0,t.jsx)("th",{children:"Contribution Status"}),(0,t.jsx)("th",{children:"Loan Payment Status"}),(0,t.jsx)("th",{children:"Loans"})]})}),(0,t.jsx)("tbody",{children:c.map(e=>{let s="ON_TIME"===e.contribution_status?"badge-success":"PARTIAL"===e.contribution_status?"badge-warning":"LATE"===e.contribution_status?"badge-danger":"badge-neutral",a="ON_TIME"===e.contribution_status?"On Time":"PARTIAL"===e.contribution_status?"Partial":"LATE"===e.contribution_status?"Late":"No Payment",n="ON_TIME"===e.loan_payment_status?"badge-success":"PARTIAL"===e.loan_payment_status?"badge-warning":"LATE"===e.loan_payment_status?"badge-danger":"badge-neutral",l="ON_TIME"===e.loan_payment_status?"On Time":"PARTIAL"===e.loan_payment_status?"Partial":"LATE"===e.loan_payment_status?"Late":"No Loan";return(0,t.jsxs)("tr",{onClick:()=>N.push("/admin/members/".concat(e.id)),className:"cursor-pointer transition-colors hover:bg-gray-700/50",children:[(0,t.jsx)("td",{children:e.id}),(0,t.jsx)("td",{children:e.full_name}),(0,t.jsx)("td",{children:e.email}),(0,t.jsx)("td",{children:e.phone_number}),(0,t.jsx)("td",{children:e.share_count}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge ".concat(s),children:a})}),(0,t.jsx)("td",{children:(0,t.jsx)("span",{className:"badge ".concat(n),children:l})}),(0,t.jsxs)("td",{className:"space-x-1",children:[e.hasLoan&&(0,t.jsx)("span",{className:"badge badge-primary",children:"Has Loan"}),e.isCoMaker&&(0,t.jsx)("span",{className:"badge badge-info",children:"Co-maker"}),!e.hasLoan&&!e.isCoMaker&&(0,t.jsx)("span",{className:"text-xs text-gray-500",children:"None"})]})]},e.id)})})]})]})}function i(e){let{onSuccess:s}=e,[a,l]=(0,n.useState)(""),[c,i]=(0,n.useState)(""),[o,d]=(0,n.useState)(""),[m,u]=(0,n.useState)("MEMBER"),[h,x]=(0,n.useState)("0"),[b,j]=(0,n.useState)(""),[p,g]=(0,n.useState)(""),[N,f]=(0,n.useState)(""),[v,y]=(0,n.useState)("");async function S(e){e.preventDefault(),y("");let t=(0,r.h)(),n=await fetch("".concat(t,"/api/admin/users"),{method:"POST",headers:{"Content-Type":"application/json",...function(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}()},body:JSON.stringify({full_name:a,email:c,phone_number:o,role:m,share_count:Number(h),gcashNumber:b||void 0,bankName:p||void 0,bankAccountNumber:N||void 0})}),u=await n.json();n.ok?(y("✓ Member created: ".concat(u.email)),l(""),i(""),d(""),x("0"),j(""),g(""),f(""),s&&s()):y("Error: ".concat(u.error?JSON.stringify(u.error):"Unknown"))}return(0,t.jsxs)("form",{className:"card space-y-4",onSubmit:S,children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Create New Member"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Full Name *"}),(0,t.jsx)("input",{className:"input",value:a,onChange:e=>l(e.target.value),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Phone Number *"}),(0,t.jsx)("input",{className:"input",value:o,onChange:e=>d(e.target.value),required:!0})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Email *"}),(0,t.jsx)("input",{className:"input",type:"email",value:c,onChange:e=>i(e.target.value),required:!0})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Role *"}),(0,t.jsxs)("select",{className:"input",value:m,onChange:e=>u(e.target.value),children:[(0,t.jsx)("option",{value:"MEMBER",children:"Member"}),(0,t.jsx)("option",{value:"ADMIN",children:"Admin"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Initial Shares *"}),(0,t.jsx)("input",{className:"input",type:"number",min:"0",value:h,onChange:e=>x(e.target.value)})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"GCash Number"}),(0,t.jsx)("input",{className:"input",value:b,onChange:e=>j(e.target.value),placeholder:"e.g., +639123456789"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Bank Name"}),(0,t.jsx)("input",{className:"input",value:p,onChange:e=>g(e.target.value),placeholder:"e.g., BDO, Metrobank"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Bank Account Number"}),(0,t.jsx)("input",{className:"input",value:N,onChange:e=>f(e.target.value),placeholder:"e.g., 123456789"})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Create Member"}),v&&(0,t.jsx)("span",{className:"text-sm text-gray-300",children:v})]})]})}var o=a(2164);function d(e){let{onDone:s}=e,[a,l]=(0,n.useState)(null),[c,i]=(0,n.useState)(""),[o,d]=(0,n.useState)(!1),[m,u]=(0,n.useState)(null),h=async()=>{try{let e=localStorage.getItem("eq_admin_token");if(!e)return void i("Error: Not authenticated");let s=(0,r.h)(),a=await fetch("".concat(s,"/api/admin/users/import/template"),{headers:{Authorization:"Bearer ".concat(e)}});if(!a.ok){let e=await a.json();throw Error(e.error||"Download failed")}let t=await a.blob(),n=window.URL.createObjectURL(t),l=document.createElement("a");l.href=n,l.download="equiyield_member_import.xlsx",document.body.appendChild(l),l.click(),window.URL.revokeObjectURL(n),document.body.removeChild(l)}catch(e){i("Error: ".concat(e.message))}},x=async()=>{if(a){d(!0),i("Uploading…");try{let e=new FormData;e.append("file",a);let t=(0,r.h)(),n=await fetch("".concat(t,"/api/admin/users/import"),{method:"POST",headers:(()=>{let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}})(),body:e}),l=await n.json();if(!n.ok)throw Error(l.error||"Import failed");u(l),i("Imported ".concat(l.successCount," record(s), ").concat(l.errorCount," error(s)")),s&&s()}catch(e){i("Error: ".concat(e.message))}finally{d(!1)}}};return(0,t.jsxs)("div",{className:"card space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Bulk Import Members (Excel)"}),(0,t.jsx)("button",{className:"btn btn-secondary",onClick:h,children:"Download Template"})]}),(0,t.jsx)("input",{type:"file",accept:".xlsx,.xls",onChange:e=>{var s;return l((null==(s=e.target.files)?void 0:s[0])||null)}}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("button",{className:"btn btn-primary",onClick:x,disabled:!a||o,children:"Upload"}),c&&(0,t.jsx)("span",{className:"text-sm text-gray-300",children:c})]}),m&&m.errors&&m.errors.length>0&&(0,t.jsxs)("div",{className:"mt-2 text-sm",children:[(0,t.jsx)("div",{className:"text-red-300 font-semibold mb-1",children:"Errors"}),(0,t.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:m.errors.map((e,s)=>(0,t.jsxs)("li",{children:["Row ",e.row,": ",e.message]},s))})]}),m&&m.created&&m.created.length>0&&(0,t.jsxs)("div",{className:"mt-2 text-sm",children:[(0,t.jsx)("div",{className:"text-green-300 font-semibold mb-1",children:"Created"}),(0,t.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:m.created.map(e=>(0,t.jsxs)("li",{children:[e.email," — password: ",(0,t.jsx)("span",{className:"font-mono",children:e.password})]},e.id))}),(0,t.jsx)("div",{className:"text-xs text-gray-400 mt-2",children:"Share these passwords securely with members."})]})]})}function m(e){var s;let{userIds:a}=e,[l,c]=(0,n.useState)(!1),[i,o]=(0,n.useState)(null),[d,m]=(0,n.useState)(""),[u,h]=(0,n.useState)(!1),[x,b]=(0,n.useState)(!0),j=async()=>{c(!0),m(""),o(null);try{let e=(0,r.h)(),s=await fetch("".concat(e,"/api/admin/users/bulk-passwords"),{method:"POST",headers:{"Content-Type":"application/json",...function(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}()},body:JSON.stringify({userIds:a,sendEmail:u,excludeAdmins:x})}),t=await s.json();if(!s.ok)throw Error(t.error||"Bulk reset failed");o(t)}catch(e){m(e.message)}finally{c(!1)}};return(0,t.jsxs)("div",{className:"card space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h3",{className:"font-semibold",children:"Bulk Password Reset"}),(0,t.jsxs)("div",{className:"flex gap-4",children:[(0,t.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:x,onChange:e=>b(e.target.checked)}),"Exclude admin accounts"]}),(0,t.jsxs)("label",{className:"text-sm flex items-center gap-2",children:[(0,t.jsx)("input",{type:"checkbox",checked:u,onChange:e=>h(e.target.checked)}),"Email passwords to members"]})]})]}),(0,t.jsx)("button",{className:"btn btn-primary",onClick:j,disabled:l||0===a.length,children:l?"Running…":"Reset for ".concat(a.length," member(s)")}),d&&(0,t.jsx)("div",{className:"text-red-300 text-sm",children:d}),i&&(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("div",{className:"text-green-300 font-semibold mb-1",children:"New Passwords"}),(0,t.jsx)("ul",{className:"list-disc pl-5 space-y-1",children:null==(s=i.results)?void 0:s.map(e=>(0,t.jsxs)("li",{children:[e.email," — ",(0,t.jsx)("span",{className:"font-mono",children:e.password})," ",e.emailed?"(emailed)":""]},e.id))})]})]})}function u(){let[e,s]=(0,n.useState)(0),[a,l]=(0,n.useState)(!1),[r,u]=(0,n.useState)(!1),[h,x]=(0,n.useState)(!1),[b,j]=(0,n.useState)(!1),[p,g]=(0,n.useState)([]);return(0,t.jsxs)("main",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Member Management"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Create members, record contributions, and manage accounts"})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Quick Actions"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[(0,t.jsxs)("button",{className:"btn btn-success flex-col h-auto py-4",onClick:()=>l(!a),children:[(0,t.jsx)("span",{className:"text-2xl mb-1",children:"➕"}),(0,t.jsx)("span",{className:"text-sm",children:"Create Member"})]}),(0,t.jsxs)("button",{className:"btn btn-primary flex-col h-auto py-4",onClick:()=>u(!r),children:[(0,t.jsx)("span",{className:"text-2xl mb-1",children:"\uD83D\uDCB0"}),(0,t.jsx)("span",{className:"text-sm",children:"Record Payment"})]}),(0,t.jsxs)("button",{className:"btn btn-secondary flex-col h-auto py-4",onClick:()=>x(!h),children:[(0,t.jsx)("span",{className:"text-2xl mb-1",children:"\uD83D\uDCE5"}),(0,t.jsx)("span",{className:"text-sm",children:"Bulk Import"})]}),(0,t.jsxs)("button",{className:"btn btn-warning flex-col h-auto py-4",onClick:()=>j(!b),children:[(0,t.jsx)("span",{className:"text-2xl mb-1",children:"\uD83D\uDD11"}),(0,t.jsx)("span",{className:"text-sm",children:"Reset Passwords"})]})]})]}),a&&(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Create New Member"}),(0,t.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>l(!1),children:"✕ Close"})]}),(0,t.jsx)(i,{onSuccess:()=>{s(e=>e+1),l(!1)}})]}),r&&(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Record Contribution"}),(0,t.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>u(!1),children:"✕ Close"})]}),(0,t.jsx)(o.default,{})]}),h&&(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Bulk Import Members"}),(0,t.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>x(!1),children:"✕ Close"})]}),(0,t.jsx)(d,{onDone:()=>{s(e=>e+1),x(!1)}})]}),b&&(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Bulk Password Reset"}),(0,t.jsx)("button",{className:"btn btn-ghost btn-sm",onClick:()=>j(!1),children:"✕ Close"})]}),(0,t.jsx)(m,{userIds:p}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-3 p-3 bg-yellow-50 rounded border border-yellow-200",children:["ℹ️ ",(0,t.jsx)("strong",{children:"Note:"})," This will reset passwords for all members visible on the current page below."]})]}),(0,t.jsx)(c,{refreshToken:e,onIdsChange:g})]})}},2164:(e,s,a)=>{"use strict";a.d(s,{default:()=>c});var t=a(4568),n=a(7620),l=a(220);function r(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function c(e){let{onSuccess:s}=e,[a,c]=(0,n.useState)([]),[i,o]=(0,n.useState)(null),[d,m]=(0,n.useState)(""),[u,h]=(0,n.useState)(""),[x,b]=(0,n.useState)(new Date().toISOString().split("T")[0]),[j,p]=(0,n.useState)("GCASH"),[g,N]=(0,n.useState)(""),[f,v]=(0,n.useState)("");(0,n.useEffect)(()=>{!async function(){let e=(0,l.h)(),[s,a]=await Promise.all([fetch("".concat(e,"/api/admin/users"),{headers:r(),cache:"no-store"}),fetch("".concat(e,"/api/admin/system-config"),{headers:r(),cache:"no-store"})]),[t,n]=await Promise.all([s.json(),a.json()]);c(t),o(n)}()},[]);let y=(0,n.useMemo)(()=>a.find(e=>e.id===d),[a,d]),S=(0,n.useMemo)(()=>y&&i?y.share_count*i.share_value:0,[y,i]),w=Number(u||0),C=w>0&&S>0&&w!==S;async function k(e){if(e.preventDefault(),v(""),!d||!x||!g)return void v("Please fill all required fields.");let a=(0,l.h)(),t=await fetch("".concat(a,"/api/admin/contributions"),{method:"POST",headers:{"Content-Type":"application/json",...r()},body:JSON.stringify({userId:d,amount:w,date_paid:new Date(x).toISOString(),method:j,reference_number:g})}),n=await t.json();t.ok?(v("Saved. Status: ".concat(n.status,". Expected: PHP ").concat(n.expected)),m(""),h(""),b(new Date().toISOString().split("T")[0]),p("GCASH"),N(""),s&&s()):v("Error: ".concat(n.error?JSON.stringify(n.error):"Unknown"))}return(0,t.jsxs)("form",{className:"card space-y-4",onSubmit:k,children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Member"}),(0,t.jsxs)("select",{className:"input",value:d,onChange:e=>m(Number(e.target.value)),children:[(0,t.jsx)("option",{value:"",children:"Select user…"}),a.map(e=>(0,t.jsxs)("option",{value:e.id,children:[e.full_name||e.email," — ",e.email," (shares: ",e.share_count,")"]},e.id))]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Amount (PHP)"}),(0,t.jsx)("input",{className:"input",type:"number",value:u,onChange:e=>h(e.target.value)}),S>0&&(0,t.jsxs)("p",{className:C?"text-yellow-400 text-sm mt-1":"text-gray-400 text-sm mt-1",children:["Expected full amount: PHP ",S]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Date Paid"}),(0,t.jsx)("input",{className:"input",type:"date",value:x,onChange:e=>b(e.target.value)})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Method"}),(0,t.jsxs)("select",{className:"input",value:j,onChange:e=>p(e.target.value),children:[(0,t.jsx)("option",{value:"GCASH",children:"GCash"}),(0,t.jsx)("option",{value:"INSTAPAY",children:"InstaPay"}),(0,t.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"}),(0,t.jsx)("option",{value:"CASH",children:"Cash"})]})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"label",children:"Reference Number"}),(0,t.jsx)("input",{className:"input",value:g,onChange:e=>N(e.target.value),placeholder:"e.g., GCash Ref#"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("button",{className:"btn btn-primary",type:"submit",children:"Record Contribution"}),C&&(0,t.jsx)("span",{className:"badge badge-danger",children:"Partial Payment"})]}),f&&(0,t.jsx)("p",{className:"text-sm text-gray-300",children:f})]})}},7541:(e,s,a)=>{"use strict";var t=a(3041);a.o(t,"useParams")&&a.d(s,{useParams:function(){return t.useParams}}),a.o(t,"usePathname")&&a.d(s,{usePathname:function(){return t.usePathname}}),a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}})},9812:(e,s,a)=>{Promise.resolve().then(a.bind(a,537))}},e=>{e.O(0,[587,18,358],()=>e(e.s=9812)),_N_E=e.O()}]);