(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[165],{220:(e,t,s)=>{"use strict";function a(){{let e=window.location.hostname;return"http://".concat(e,":4000")}}s.d(t,{h:()=>a})},5045:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(4568),r=s(7620),l=s(220);function n(){let[e,t]=(0,r.useState)(new Date().getFullYear()),[s,n]=(0,r.useState)(""),[c,i]=(0,r.useState)("GCASH"),[d,x]=(0,r.useState)(""),[o,m]=(0,r.useState)(new Date().toISOString().split("T")[0]),[h,p]=(0,r.useState)(!1),[u,y]=(0,r.useState)(null),[b,g]=(0,r.useState)(""),N=async t=>{if(t.preventDefault(),g(""),y(null),!s||!d||!o)return void g("All fields are required");p(!0);try{let t=(0,l.h)(),a=await fetch("".concat(t,"/api/admin/dividends/payouts/bulk"),{method:"POST",headers:{"Content-Type":"application/json",...function(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}()},body:JSON.stringify({year:Number(e),perShare:parseFloat(s),channel:c,reference:d,depositedAt:new Date(o).toISOString()})}),r=await a.json();if(!a.ok)throw Error(r.error||"Failed to create payouts");y(r),n(""),x("")}catch(e){g(e.message)}finally{p(!1)}};return(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Bulk Dividend Payout"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"Distribute dividends to all eligible members for a specific year using a single reference number."}),(0,a.jsxs)("form",{onSubmit:N,className:"space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("label",{className:"text-sm",children:["Year",(0,a.jsx)("input",{type:"number",className:"input mt-1",value:e,onChange:e=>t(Number(e.target.value)),required:!0})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Per Share Amount (PHP)",(0,a.jsx)("input",{type:"number",step:"0.01",className:"input mt-1",value:s,onChange:e=>n(e.target.value),placeholder:"e.g., 500.50",required:!0})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"radio",name:"channel",checked:"GCASH"===c,onChange:()=>i("GCASH")}),"GCash"]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"radio",name:"channel",checked:"BANK"===c,onChange:()=>i("BANK")}),"Bank"]})]}),(0,a.jsxs)("label",{className:"text-sm",children:["Reference Number ",(0,a.jsx)("span",{className:"text-red-500",children:"*"}),(0,a.jsx)("input",{type:"text",className:"input mt-1",value:d,onChange:e=>x(e.target.value),placeholder:"e.g., BATCH_001, or batch transaction ID",required:!0})]}),(0,a.jsx)("p",{className:"text-xs text-gray-400",children:"Used to track the batch payout source (receipt, transfer ID, etc.)"}),(0,a.jsxs)("label",{className:"text-sm",children:["Deposit Date",(0,a.jsx)("input",{type:"date",className:"input mt-1",value:o,onChange:e=>m(e.target.value),required:!0})]}),b&&(0,a.jsx)("div",{className:"p-3 bg-red-900/30 text-red-300 rounded text-sm",children:b}),(0,a.jsx)("button",{type:"submit",className:"btn btn-primary w-full",disabled:h,children:h?"Processing...":"Distribute to Eligible Members"})]}),u&&(0,a.jsxs)("div",{className:"mt-6 border-t border-gray-700/50 pt-4",children:[(0,a.jsxs)("div",{className:"mb-4 p-3 bg-blue-900/30 text-blue-300 rounded text-sm",children:["Summary: ",u.summary.created," created, ",u.summary.failed," failed out of ",u.summary.total," eligible members"]}),u.created.length>0&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)("h4",{className:"font-semibold text-sm mb-2",children:["✓ Created (",u.created.length,")"]}),(0,a.jsx)("div",{className:"space-y-1 text-xs",children:u.created.map(e=>(0,a.jsxs)("div",{className:"text-gray-300",children:[e.full_name," - ₱",e.amount.toLocaleString()]},e.id))})]}),u.failed.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"font-semibold text-sm mb-2 text-yellow-400",children:["⚠ Failed (",u.failed.length,")"]}),(0,a.jsx)("div",{className:"space-y-1 text-xs",children:u.failed.map((e,t)=>(0,a.jsxs)("div",{className:"text-gray-400",children:[e.full_name,": ",e.error]},t))})]})]})]})}function c(){let e=localStorage.getItem("eq_admin_token");return e?{Authorization:"Bearer ".concat(e)}:{}}function i(){let[e,t]=(0,r.useState)([]),[s,i]=(0,r.useState)([]),[d,x]=(0,r.useState)(!0),[o,m]=(0,r.useState)(""),[h,p]=(0,r.useState)(new Date().getFullYear()),[u,y]=(0,r.useState)(0),[b,g]=(0,r.useState)(0),[N,f]=(0,r.useState)(!0),[j,v]=(0,r.useState)(!1),[S,w]=(0,r.useState)({amount:"",description:"",referenceType:"NONE",reference:""}),[C,E]=(0,r.useState)(!1),[k,A]=(0,r.useState)(""),D=async e=>{try{x(!0),m("");let s=(0,l.h)(),a="".concat(s,"/api/admin/dividends/payouts");(null==e?void 0:e.year)&&(a+="?year=".concat(e.year));let r=await fetch(a,{headers:c(),cache:"no-store"});if(!r.ok)throw Error("Failed to fetch payouts");let n=await r.json();t(n);let i=n.filter(e=>e.year===h).reduce((e,t)=>e+t.amount,0);y(i)}catch(e){m(e.message)}},T=async()=>{try{let e=(0,l.h)(),t=await fetch("".concat(e,"/api/admin/expenses?year=").concat(h),{headers:c(),cache:"no-store"});if(!t.ok)throw Error("Failed to fetch expenses");let s=await t.json();i(s);let a=s.reduce((e,t)=>e+t.amount,0);g(a)}catch(e){console.error("Failed to load expenses:",e.message)}},P=async()=>{if(!S.amount||!S.description)return void A("Amount and description required");E(!0),A("");try{let e=(0,l.h)();if(!(await fetch("".concat(e,"/api/admin/expenses"),{method:"POST",headers:{"Content-Type":"application/json",...c()},body:JSON.stringify({amount:Number(S.amount),description:S.description,referenceType:S.referenceType,reference:S.reference,year:h})})).ok)throw Error("Failed to create expense");await T(),v(!1),w({amount:"",description:"",referenceType:"NONE",reference:""})}catch(e){A(e.message)}finally{E(!1)}},_=async e=>{if(window.confirm("Delete this expense?"))try{let t=(0,l.h)();if(!(await fetch("".concat(t,"/api/admin/expenses/").concat(e),{method:"DELETE",headers:c()})).ok)throw Error("Failed to delete expense");await T()}catch(e){alert("Failed to delete expense: "+e.message)}};(0,r.useEffect)(()=>{D({year:h}),T(),x(!1)},[h]);let F=e=>new Intl.NumberFormat("en-PH",{style:"currency",currency:"PHP",minimumFractionDigits:0}).format(e),O=e=>new Date(e).toLocaleDateString("en-PH"),B=e.filter(e=>e.year===h),H=[...new Set(e.map(e=>e.year))].sort((e,t)=>t-e);return(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Dividend & Expenses Management"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"Year"}),(0,a.jsx)("select",{value:h,onChange:e=>p(Number(e.target.value)),className:"input w-full",children:H.map(e=>(0,a.jsx)("option",{value:e,children:e},e))})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"Payouts Distributed"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-gray-100",children:B.length})]}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("div",{className:"text-sm text-gray-400 mb-1",children:"Total Payout Amount"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-green-400",children:F(u)})]})]}),(0,a.jsx)("div",{className:"mb-6",children:(0,a.jsx)(n,{})}),(0,a.jsxs)("div",{className:"card mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold",children:"Operating Expenses"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("button",{className:"btn btn-success btn-sm text-sm",onClick:()=>{w({amount:"",description:"",referenceType:"NONE",reference:""}),A(""),v(!0)},children:"+ Add Expense"}),(0,a.jsx)("button",{className:"btn btn-secondary btn-sm text-sm",onClick:()=>f(!N),children:N?"Collapse":"Expand"})]})]}),N?0===s.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-400",children:["No expenses recorded for ",h]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-4 grid grid-cols-2 gap-4",children:(0,a.jsxs)("div",{className:"p-3 rounded border border-gray-700 bg-gray-900/50",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:"Total Expenses"}),(0,a.jsx)("div",{className:"text-2xl font-bold text-red-400",children:F(b)})]})}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-800/50",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Date"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Description"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-300",children:"Amount"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Type"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Reference"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Created By"}),(0,a.jsx)("th",{className:"px-4 py-3 text-center text-xs font-semibold text-gray-300",children:"Action"})]})}),(0,a.jsx)("tbody",{children:s.map(e=>{var t;return(0,a.jsxs)("tr",{className:"border-b border-gray-700/50 hover:bg-gray-800/30",children:[(0,a.jsx)("td",{className:"px-4 py-3 text-gray-300",children:O(e.createdAt)}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-300",children:e.description}),(0,a.jsx)("td",{className:"px-4 py-3 text-right font-bold text-red-400",children:F(e.amount)}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"text-xs badge badge-sm",children:e.referenceType})}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500 font-mono",children:e.reference||"—"}),(0,a.jsx)("td",{className:"px-4 py-3 text-xs text-gray-500",children:(null==(t=e.createdBy)?void 0:t.full_name)||"System"}),(0,a.jsx)("td",{className:"px-4 py-3 text-center",children:(0,a.jsx)("button",{className:"btn btn-error btn-xs",onClick:()=>_(e.id),children:"Delete"})})]},e.id)})})]})})]}):null]}),j&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"card w-full max-w-md mx-auto p-6",children:[(0,a.jsx)("h3",{className:"font-bold text-lg mb-4",children:"Add Operating Expense"}),k&&(0,a.jsx)("div",{className:"mb-4 p-3 rounded bg-red-900/20 text-red-300 text-sm",children:k}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label text-sm",children:"Amount (₱) *"}),(0,a.jsx)("input",{type:"number",className:"input input-bordered w-full",placeholder:"1000",value:S.amount,onChange:e=>w({...S,amount:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label text-sm",children:"Description *"}),(0,a.jsx)("textarea",{className:"textarea textarea-bordered w-full",placeholder:"Office supplies, maintenance, etc.",rows:3,value:S.description,onChange:e=>w({...S,description:e.target.value})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label text-sm",children:"Reference Type"}),(0,a.jsxs)("select",{className:"select select-bordered w-full",value:S.referenceType,onChange:e=>w({...S,referenceType:e.target.value}),children:[(0,a.jsx)("option",{value:"NONE",children:"None"}),(0,a.jsx)("option",{value:"GCASH",children:"GCash"}),(0,a.jsx)("option",{value:"RECEIPT",children:"Receipt"}),(0,a.jsx)("option",{value:"BANK_TRANSFER",children:"Bank Transfer"})]})]}),"NONE"!==S.referenceType&&(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"label text-sm",children:"Reference Number/Code"}),(0,a.jsx)("input",{type:"text",className:"input input-bordered w-full",placeholder:"e.g., GCash reference or receipt number",value:S.reference,onChange:e=>w({...S,reference:e.target.value})})]})]}),(0,a.jsxs)("div",{className:"flex gap-2 mt-6",children:[(0,a.jsx)("button",{className:"btn btn-ghost flex-1",onClick:()=>v(!1),disabled:C,children:"Cancel"}),(0,a.jsx)("button",{className:"btn btn-success flex-1",onClick:P,disabled:C,children:C?"Saving...":"Save Expense"})]})]})}),(0,a.jsxs)("div",{className:"card",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold mb-4",children:"Payout Records"}),o&&(0,a.jsx)("div",{className:"mb-4 rounded-lg border border-red-200 bg-red-50 p-4 text-red-700",children:o}),0===B.length?(0,a.jsxs)("div",{className:"text-center py-8 text-gray-400",children:["No payouts recorded for ",h]}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-gray-800/50",children:(0,a.jsxs)("tr",{className:"border-b border-gray-700",children:[(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Member"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-300",children:"Per Share"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-300",children:"Shares"}),(0,a.jsx)("th",{className:"px-4 py-3 text-right text-xs font-semibold text-gray-300",children:"Amount"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Channel"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Reference"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Deposited"}),(0,a.jsx)("th",{className:"px-4 py-3 text-left text-xs font-semibold text-gray-300",children:"Created By"})]})}),(0,a.jsx)("tbody",{children:B.map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-700/50 hover:bg-gray-800/30",children:[(0,a.jsxs)("td",{className:"px-4 py-3",children:[(0,a.jsx)("div",{className:"font-medium text-gray-200 text-sm",children:e.user.full_name}),(0,a.jsx)("div",{className:"text-xs text-gray-500",children:e.user.email})]}),(0,a.jsxs)("td",{className:"px-4 py-3 text-right font-medium text-gray-300 text-sm",children:["₱",e.perShare.toLocaleString(void 0,{maximumFractionDigits:2})]}),(0,a.jsx)("td",{className:"px-4 py-3 text-right text-gray-300 text-sm",children:e.sharesCount}),(0,a.jsx)("td",{className:"px-4 py-3 text-right font-bold text-green-400 text-sm",children:F(e.amount)}),(0,a.jsx)("td",{className:"px-4 py-3",children:(0,a.jsx)("span",{className:"inline-block px-2 py-1 rounded text-xs font-medium ".concat("GCASH"===e.channel?"bg-blue-900/30 text-blue-300":"bg-purple-900/30 text-purple-300"),children:e.channel})}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-400 font-mono text-xs",children:e.reference}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-400 text-sm",children:O(e.depositedAt)}),(0,a.jsx)("td",{className:"px-4 py-3 text-gray-500 text-sm",children:e.createdBy?e.createdBy.full_name:"System"})]},e.id))})]})})]})]})}},6575:(e,t,s)=>{Promise.resolve().then(s.bind(s,5045))}},e=>{e.O(0,[587,18,358],()=>e(e.s=6575)),_N_E=e.O()}]);